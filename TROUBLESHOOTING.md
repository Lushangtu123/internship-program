# 🔧 故障排查指南

## 评论区使用说明

### 如何打开评论区？

有**3种方式**打开评论抽屉：

#### 方式1：点击评论图标 💬
1. 找到视频右侧的动作栏
2. 点击**💬评论图标**（第二个按钮）
3. 评论抽屉会从底部（移动端）或右侧（桌面端）滑出

#### 方式2：键盘快捷键 ⌨️
1. 确保焦点在页面上（不在输入框中）
2. 按 **/** 键（斜杠键）
3. 评论抽屉会自动打开并聚焦输入框

#### 方式3：触摸操作 📱
1. 在移动设备上，找到评论图标
2. 轻触评论图标
3. 抽屉从底部滑出

---

## 评论区功能测试

### 测试评论加载
```bash
# 在终端运行此命令，检查API是否正常
curl http://localhost:3000/api/videos/v_001/comments
```

应该返回类似这样的JSON：
```json
{
  "items": [
    {
      "id": "c_001",
      "username": "bunny_lover",
      "text": "This is so cute! 🐰❤️",
      ...
    }
  ]
}
```

### 测试发送评论
1. 打开评论抽屉
2. 在输入框输入评论文字
3. 点击发送按钮（✈️图标）或按回车
4. 评论应该立即出现在列表顶部（乐观更新）

---

## 常见问题

### ❌ 问题：点击评论图标没有反应

**可能原因1：JavaScript未加载**
- 检查浏览器控制台是否有错误
- 按 `F12` 打开开发者工具，查看Console标签

**可能原因2：状态管理问题**
- 刷新页面（`Cmd+R` 或 `Ctrl+R`）
- 清除浏览器缓存

**解决方案：**
```bash
# 重启开发服务器
killall -9 node
npm run dev
```

---

### ❌ 问题：评论抽屉打开了但是空白

**可能原因：CSS未加载**

**解决方案：**
1. 检查网络请求（开发者工具 > Network标签）
2. 确保没有CSS加载失败
3. 刷新页面

---

### ❌ 问题：无法发送评论

**可能原因1：输入框为空**
- 评论必须包含至少一个非空白字符

**可能原因2：API错误**
- 检查浏览器控制台错误信息
- 检查终端服务器日志

**解决方案：**
```bash
# 测试API端点
curl -X POST http://localhost:3000/api/videos/v_001/comments \
  -H "Content-Type: application/json" \
  -d '{"text":"测试评论"}'
```

---

### ❌ 问题：评论抽屉无法关闭

**解决方案：**
1. 点击关闭按钮（X图标）
2. 点击背景遮罩层
3. 按 `Esc` 键
4. 如果都不行，刷新页面

---

## 详细诊断步骤

### 步骤1：检查元素是否存在
1. 打开浏览器开发者工具（F12）
2. 切换到 Elements/元素 标签
3. 搜索 "CommentsDrawer" 或 "comment"
4. 检查元素是否在DOM中

### 步骤2：检查JavaScript错误
1. 打开浏览器开发者工具（F12）
2. 切换到 Console/控制台 标签
3. 查看是否有红色错误信息
4. 截图错误并报告

### 步骤3：检查网络请求
1. 打开浏览器开发者工具（F12）
2. 切换到 Network/网络 标签
3. 点击评论图标
4. 查看是否有请求到 `/api/videos/xxx/comments`
5. 检查请求状态码（应该是200）

### 步骤4：检查状态
1. 打开浏览器控制台（F12 > Console）
2. 输入以下代码查看状态：
```javascript
// 这会在实际应用中显示当前状态
console.log('Comments Open:', document.querySelector('[aria-label*="comment"]'));
```

---

## 手动测试清单

- [ ] 能看到评论图标（💬）
- [ ] 点击评论图标后抽屉滑出
- [ ] 抽屉中显示"Comments"标题
- [ ] 能看到现有评论列表
- [ ] 能在输入框输入文字
- [ ] 点击发送按钮能发送评论
- [ ] 新评论立即出现在列表顶部
- [ ] 能点击X按钮关闭抽屉
- [ ] 按/键能打开评论
- [ ] 在移动端抽屉从底部滑出
- [ ] 在桌面端抽屉从右侧滑出

---

## 调试模式

访问 http://localhost:3000?debug=1 查看详细的性能和交互数据：

- `commentOpened` - 评论打开次数
- 如果这个数字不增加，说明点击事件没有触发

---

## 视觉参考

### 评论图标位置
```
┌─────────────────────┐
│                     │
│    视频内容          │
│                     │
│                  ┌──┤ ← 右侧动作栏
│                  │❤️│ ← 点赞
│                  │💬│ ← 评论（这个！）
│                  │↗️│ ← 分享
│                  │📑│ ← 收藏
└──────────────────┴──┘
```

### 评论抽屉示例
```
移动端：
┌──────────────────────┐
│                      │
│     视频内容          │
├──────────────────────┤
│ Comments (2)      [X]│ ← 标题栏
├──────────────────────┤
│ 👤 user1             │
│    评论内容...       │
│                      │
│ 👤 user2             │
│    评论内容...       │
├──────────────────────┤
│ [输入框...]   [✈️]  │ ← 输入区
└──────────────────────┘
```

---

## 如果问题仍未解决

### 完全重置项目
```bash
# 1. 停止服务器
killall -9 node

# 2. 清理缓存
rm -rf .next node_modules

# 3. 重新安装
npm install

# 4. 重启服务器
npm run dev
```

### 查看服务器日志
评论相关的请求应该在终端显示：
```
GET /api/videos/v_001/comments 200 in 10ms
POST /api/videos/v_001/comments 200 in 50ms
```

### 收集信息
如果仍有问题，请提供：
1. 浏览器名称和版本
2. 操作系统
3. 浏览器控制台的错误截图
4. 终端服务器日志
5. 具体的错误描述

---

## 快速检查命令

```bash
# 检查服务器是否运行
lsof -ti:3000

# 检查API是否工作
curl http://localhost:3000/api/videos

# 检查评论API
curl http://localhost:3000/api/videos/v_001/comments

# 测试发送评论
curl -X POST http://localhost:3000/api/videos/v_001/comments \
  -H "Content-Type: application/json" \
  -d '{"text":"测试评论"}'
```

---

## 联系支持

如果以上方法都无法解决问题，请提供：
- 问题的详细描述
- 浏览器控制台截图
- 网络请求截图
- 终端日志

